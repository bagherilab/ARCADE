<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>PottsModuleApoptosisSimple.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">arcade</a> &gt; <a href="index.source.html" class="el_package">arcade.potts.agent.module</a> &gt; <span class="el_source">PottsModuleApoptosisSimple.java</span></div><h1>PottsModuleApoptosisSimple.java</h1><pre class="source lang-java linenums">package arcade.potts.agent.module;

import sim.util.distribution.Poisson;
import ec.util.MersenneTwisterFast;
import arcade.core.sim.Simulation;
import arcade.core.util.MiniBox;
import arcade.potts.agent.cell.PottsCell;
import static arcade.potts.util.PottsEnums.Phase;
import static arcade.potts.util.PottsEnums.Region;

/**
 * Extension of {@link PottsModuleApoptosis} with Poisson transitions.
 */

public class PottsModuleApoptosisSimple extends PottsModuleApoptosis {
    /** Threshold for critical volume size checkpoint. */
    static final double SIZE_CHECKPOINT = 0.95;
    
    /** Target ratio of critical volume for early apoptosis size checkpoint. */
    static final double EARLY_SIZE_TARGET = 0.99;
    
    /** Target ratio of critical volume for late apoptosis size checkpoint. */
    static final double LATE_SIZE_TARGET = 0.25;
    
    /** Event rate for early apoptosis (steps/tick). */
    final double rateEarly;
    
    /** Event rate for late apoptosis (steps/tick). */
    final double rateLate;
    
    /** Steps for early apoptosis (steps). */
    final int stepsEarly;
    
    /** Steps for late apoptosis (steps). */
    final int stepsLate;
    
    /** Rate of cytoplasmic water loss (voxels/tick). */
    final double waterLossRate;
    
    /** Rate of cytoplasmic blebbing (voxels/tick). */
    final double cytoBlebbingRate;
    
    /** Rate of nuclear pyknosis (voxels/tick). */
    final double nucleusPyknosisRate;
    
    /** Rate of nuclear fragmentation (voxels/tick). */
    final double nucleusFragmentationRate;
    
    /**
     * Creates a simple apoptosis {@code Module} for the given
     * {@link PottsCell}.
     *
     * @param cell  the {@link PottsCell} the module is associated with
     */
    public PottsModuleApoptosisSimple(PottsCell cell) {
<span class="fc" id="L56">        super(cell);</span>
        
<span class="fc" id="L58">        MiniBox parameters = cell.getParameters();</span>
<span class="fc" id="L59">        rateEarly = parameters.getDouble(&quot;apoptosis/RATE_EARLY&quot;);</span>
<span class="fc" id="L60">        rateLate = parameters.getDouble(&quot;apoptosis/RATE_LATE&quot;);</span>
<span class="fc" id="L61">        stepsEarly = parameters.getInt(&quot;apoptosis/STEPS_EARLY&quot;);</span>
<span class="fc" id="L62">        stepsLate = parameters.getInt(&quot;apoptosis/STEPS_LATE&quot;);</span>
<span class="fc" id="L63">        waterLossRate = parameters.getDouble(&quot;apoptosis/WATER_LOSS_RATE&quot;);</span>
<span class="fc" id="L64">        cytoBlebbingRate = parameters.getDouble(&quot;apoptosis/CYTOPLASMIC_BLEBBING_RATE&quot;);</span>
<span class="fc" id="L65">        nucleusPyknosisRate = parameters.getDouble(&quot;apoptosis/NUCLEUS_PYKNOSIS_RATE&quot;);</span>
<span class="fc" id="L66">        nucleusFragmentationRate = parameters.getDouble(&quot;apoptosis/NUCLEUS_FRAGMENTATION_RATE&quot;);</span>
<span class="fc" id="L67">    }</span>
    
    /**
     * {@inheritDoc}
     * &lt;p&gt;
     * Cell decreases in size due to cytoplasmic water loss and nuclear
     * pyknosis. Cell will transition to late apoptosis after completing
     * {@code STEPS_EARLY} steps at an average rate of {@code RATE_EARLY}.
     */
    @Override
    void stepEarly(MersenneTwisterFast random) {
        // Decrease size of cell.
<span class="fc" id="L79">        cell.updateTarget(waterLossRate, EARLY_SIZE_TARGET);</span>
        
        // Decrease size of nucleus (if cell has regions).
<span class="fc bfc" id="L82" title="All 2 branches covered.">        if (cell.hasRegions()) {</span>
<span class="fc" id="L83">            cell.updateTarget(Region.NUCLEUS, nucleusPyknosisRate, EARLY_SIZE_TARGET);</span>
        }
        
        // Check for phase transition.
<span class="fc" id="L87">        Poisson poisson = poissonFactory.createPoisson(rateEarly, random);</span>
<span class="fc" id="L88">        currentSteps += poisson.nextInt();</span>
<span class="fc bfc" id="L89" title="All 2 branches covered.">        if (currentSteps &gt;= stepsEarly) {</span>
<span class="fc" id="L90">            setPhase(Phase.APOPTOTIC_LATE);</span>
        }
<span class="fc" id="L92">    }</span>
    
    /**
     * {@inheritDoc}
     * &lt;p&gt;
     * Cell continues to decrease in size due to cytoplasm blebbing and nuclear
     * fragmentation. Cell will complete apoptosis after completing
     * {@code STEPS_LATE} steps at an average rate of {@code RATE_LATE} or if
     * the total cell volume falls below a threshold of
     * {@code APOPTOSIS_CHECKPOINT} times the critical size. Cell must be less
     * than {@code LATE_SIZE_CHECKPOINT} times the critical size.
     */
    @Override
    void stepLate(MersenneTwisterFast random, Simulation sim) {
        // Decrease size of cell.
<span class="fc" id="L107">        cell.updateTarget(cytoBlebbingRate, LATE_SIZE_TARGET);</span>
<span class="fc" id="L108">        boolean sizeCheck = cell.getVolume() &lt;= SIZE_CHECKPOINT</span>
<span class="fc bfc" id="L109" title="All 2 branches covered.">                * LATE_SIZE_TARGET * cell.getCriticalVolume();</span>
        
        // Decrease size of nucleus (if cell has regions).
<span class="fc bfc" id="L112" title="All 2 branches covered.">        if (cell.hasRegions()) {</span>
<span class="fc" id="L113">            cell.updateTarget(Region.NUCLEUS, nucleusFragmentationRate, 0);</span>
        }
        
        // Check for completion of late phase.
<span class="fc" id="L117">        Poisson poisson = poissonFactory.createPoisson(rateLate, random);</span>
<span class="fc" id="L118">        currentSteps += poisson.nextInt();</span>
<span class="fc bfc" id="L119" title="All 4 branches covered.">        if (currentSteps &gt;= stepsLate &amp;&amp; sizeCheck) {</span>
<span class="fc" id="L120">            removeCell(sim);</span>
<span class="fc" id="L121">            setPhase(Phase.APOPTOSED);</span>
        }
<span class="fc" id="L123">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.5.201910111838</span></div></body></html>