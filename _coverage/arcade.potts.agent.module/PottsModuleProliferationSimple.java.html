<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>PottsModuleProliferationSimple.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">arcade</a> &gt; <a href="index.source.html" class="el_package">arcade.potts.agent.module</a> &gt; <span class="el_source">PottsModuleProliferationSimple.java</span></div><h1>PottsModuleProliferationSimple.java</h1><pre class="source lang-java linenums">package arcade.potts.agent.module;

import sim.util.distribution.Poisson;
import ec.util.MersenneTwisterFast;
import arcade.core.sim.Simulation;
import arcade.core.util.Parameters;
import arcade.potts.agent.cell.PottsCell;
import arcade.potts.env.location.PottsLocations;
import arcade.potts.sim.Potts;
import arcade.potts.sim.PottsSimulation;
import static arcade.potts.util.PottsEnums.Phase;
import static arcade.potts.util.PottsEnums.Region;
import static arcade.potts.util.PottsEnums.State;

/** Extension of {@link PottsModuleProliferation} with Poisson transitions. */
public class PottsModuleProliferationSimple extends PottsModuleProliferation {
    /** Threshold for critical volume size checkpoint. */
    static final double SIZE_CHECKPOINT = 0.95;

    /** Target ratio of critical volume for division size checkpoint. */
    static final double SIZE_TARGET = 2;

    /** Event rate for G1 phase (steps/tick). */
    final double rateG1;

    /** Event rate for S phase (steps/tick). */
    final double rateS;

    /** Event rate for G2 phase (steps/tick). */
    final double rateG2;

    /** Event rate for M phase (steps/tick). */
    final double rateM;

    /** Steps for G1 phase (steps). */
    final int stepsG1;

    /** Steps for S phase (steps). */
    final int stepsS;

    /** Steps for G2 phase (steps). */
    final int stepsG2;

    /** Steps for M phase (steps). */
    final int stepsM;

    /** Overall growth rate for cell (voxels/tick). */
    final double cellGrowthRate;

    /** Overall growth rate for nucleus (voxels/tick). */
    final double nucleusGrowthRate;

    /** Basal rate of apoptosis (ticks^-1). */
    final double basalApoptosisRate;

    /** Fraction of nuclear volume when condensed. */
    final double nucleusCondFraction;

    /**
     * Creates a simple proliferation {@code Module} for the given {@link PottsCell}.
     *
     * @param cell the {@link PottsCell} the module is associated with
     */
    public PottsModuleProliferationSimple(PottsCell cell) {
<span class="fc" id="L65">        super(cell);</span>

<span class="fc" id="L67">        Parameters parameters = cell.getParameters();</span>
<span class="fc" id="L68">        rateG1 = parameters.getDouble(&quot;proliferation/RATE_G1&quot;);</span>
<span class="fc" id="L69">        rateS = parameters.getDouble(&quot;proliferation/RATE_S&quot;);</span>
<span class="fc" id="L70">        rateG2 = parameters.getDouble(&quot;proliferation/RATE_G2&quot;);</span>
<span class="fc" id="L71">        rateM = parameters.getDouble(&quot;proliferation/RATE_M&quot;);</span>
<span class="fc" id="L72">        stepsG1 = parameters.getInt(&quot;proliferation/STEPS_G1&quot;);</span>
<span class="fc" id="L73">        stepsS = parameters.getInt(&quot;proliferation/STEPS_S&quot;);</span>
<span class="fc" id="L74">        stepsG2 = parameters.getInt(&quot;proliferation/STEPS_G2&quot;);</span>
<span class="fc" id="L75">        stepsM = parameters.getInt(&quot;proliferation/STEPS_M&quot;);</span>
<span class="fc" id="L76">        cellGrowthRate = parameters.getDouble(&quot;proliferation/CELL_GROWTH_RATE&quot;);</span>
<span class="fc" id="L77">        nucleusGrowthRate = parameters.getDouble(&quot;proliferation/NUCLEUS_GROWTH_RATE&quot;);</span>
<span class="fc" id="L78">        basalApoptosisRate = parameters.getDouble(&quot;proliferation/BASAL_APOPTOSIS_RATE&quot;);</span>
<span class="fc" id="L79">        nucleusCondFraction = parameters.getDouble(&quot;proliferation/NUCLEUS_CONDENSATION_FRACTION&quot;);</span>
<span class="fc" id="L80">    }</span>

    /**
     * {@inheritDoc}
     *
     * &lt;p&gt;Cell increases in size toward a target of twice its critical size at a rate of {@code
     * CELL_GROWTH_RATE}. Cell will transition to S phase after completing {@code STEPS_G1} steps at
     * an average rate of {@code RATE_G1}. At each tick, cell may randomly apoptosis at a basal rate
     * of {@code BASAL_APOPTOSIS_RATE}.
     */
    @Override
    void stepG1(MersenneTwisterFast random) {
        // Random chance of apoptosis.
<span class="fc bfc" id="L93" title="All 2 branches covered.">        if (random.nextDouble() &lt; basalApoptosisRate) {</span>
<span class="fc" id="L94">            cell.setState(State.APOPTOTIC);</span>
<span class="fc" id="L95">            return;</span>
        }

        // Increase size of cell.
<span class="fc" id="L99">        cell.updateTarget(cellGrowthRate, SIZE_TARGET);</span>

        // Increase size of nucleus (if cell has regions).
<span class="fc bfc" id="L102" title="All 2 branches covered.">        if (cell.hasRegions()</span>
<span class="fc bfc" id="L103" title="All 2 branches covered.">                &amp;&amp; cell.getVolume(Region.NUCLEUS) &gt; cell.getCriticalVolume(Region.NUCLEUS)) {</span>
<span class="fc" id="L104">            cell.updateTarget(Region.NUCLEUS, nucleusGrowthRate, SIZE_TARGET);</span>
        }

        // Check for phase transition.
<span class="fc" id="L108">        Poisson poisson = poissonFactory.createPoisson(rateG1, random);</span>
<span class="fc" id="L109">        currentSteps += poisson.nextInt();</span>
<span class="fc bfc" id="L110" title="All 2 branches covered.">        if (currentSteps &gt;= stepsG1) {</span>
<span class="fc" id="L111">            setPhase(Phase.PROLIFERATIVE_S);</span>
        }
<span class="fc" id="L113">    }</span>

    /**
     * {@inheritDoc}
     *
     * &lt;p&gt;Cell increases in size toward a target of twice its critical size at a rate of {@code
     * CELL_GROWTH_RATE}. Cell will transition to G2 phase after completing {@code STEPS_S} steps at
     * an average rate of {@code RATE_S}.
     */
    @Override
    void stepS(MersenneTwisterFast random) {
        // Increase size of cell.
<span class="fc" id="L125">        cell.updateTarget(cellGrowthRate, SIZE_TARGET);</span>

        // Increase size of nucleus (if cell has regions).
<span class="fc bfc" id="L128" title="All 2 branches covered.">        if (cell.hasRegions()) {</span>
<span class="fc" id="L129">            cell.updateTarget(Region.NUCLEUS, nucleusGrowthRate, SIZE_TARGET);</span>
        }

        // Check for phase transition.
<span class="fc" id="L133">        Poisson poisson = poissonFactory.createPoisson(rateS, random);</span>
<span class="fc" id="L134">        currentSteps += poisson.nextInt();</span>
<span class="fc bfc" id="L135" title="All 2 branches covered.">        if (currentSteps &gt;= stepsS) {</span>
<span class="fc" id="L136">            setPhase(Phase.PROLIFERATIVE_G2);</span>
        }
<span class="fc" id="L138">    }</span>

    /**
     * {@inheritDoc}
     *
     * &lt;p&gt;Cell increases in size toward a target of twice its critical size at a rate of {@code
     * CELL_GROWTH_RATE}. Cell will transition to M phase after completing {@code STEPS_G2} steps at
     * an average rate of {@code RATE_G2}. At each tick, cell may randomly apoptosis at a basal rate
     * of {@code BASAL_APOPTOSIS_RATE}.
     */
    @Override
    void stepG2(MersenneTwisterFast random) {
        // Random chance of apoptosis.
<span class="fc bfc" id="L151" title="All 2 branches covered.">        if (random.nextDouble() &lt; basalApoptosisRate) {</span>
<span class="fc" id="L152">            cell.setState(State.APOPTOTIC);</span>
<span class="fc" id="L153">            return;</span>
        }

        // Increase size of cell.
<span class="fc" id="L157">        cell.updateTarget(cellGrowthRate, SIZE_TARGET);</span>
<span class="fc" id="L158">        boolean sizeCheck =</span>
<span class="fc bfc" id="L159" title="All 2 branches covered.">                cell.getVolume() &gt;= SIZE_CHECKPOINT * SIZE_TARGET * cell.getCriticalVolume();</span>

        // Increase size of nucleus (if cell has regions).
<span class="fc" id="L162">        boolean sizeRegionCheck = true;</span>
<span class="fc bfc" id="L163" title="All 2 branches covered.">        if (cell.hasRegions()) {</span>
<span class="fc" id="L164">            cell.updateTarget(Region.NUCLEUS, nucleusGrowthRate, SIZE_TARGET);</span>
<span class="fc" id="L165">            sizeRegionCheck =</span>
<span class="fc" id="L166">                    cell.getVolume(Region.NUCLEUS)</span>
                            &gt;= SIZE_CHECKPOINT
                                    * SIZE_TARGET
<span class="fc bfc" id="L169" title="All 2 branches covered.">                                    * cell.getCriticalVolume(Region.NUCLEUS);</span>
        }

        // Check for phase transition.
<span class="fc" id="L173">        Poisson poisson = poissonFactory.createPoisson(rateG2, random);</span>
<span class="fc" id="L174">        currentSteps += poisson.nextInt();</span>
<span class="fc bfc" id="L175" title="All 6 branches covered.">        if (currentSteps &gt;= stepsG2 &amp;&amp; sizeCheck &amp;&amp; sizeRegionCheck) {</span>
<span class="fc" id="L176">            setPhase(Phase.PROLIFERATIVE_M);</span>
        }
<span class="fc" id="L178">    }</span>

    /**
     * {@inheritDoc}
     *
     * &lt;p&gt;Cell increases in size toward a target of twice its critical size at a rate of {@code
     * CELL_GROWTH_RATE}. Cell will complete cell division after completing {@code STEPS_M} steps at
     * an average rate of {@code RATE_M}. Cell must be greater than {@code SIZE_CHECKPOINT} times
     * the critical size.
     */
    @Override
    void stepM(MersenneTwisterFast random, Simulation sim) {
        // Increase size of cell.
<span class="fc" id="L191">        cell.updateTarget(cellGrowthRate, SIZE_TARGET);</span>

        // Update size of nucleus (if cell has regions).
<span class="fc bfc" id="L194" title="All 2 branches covered.">        if (cell.hasRegions()) {</span>
<span class="fc" id="L195">            double regionVolume = cell.getVolume(Region.NUCLEUS);</span>
<span class="fc" id="L196">            double criticalVolume = cell.getCriticalVolume(Region.NUCLEUS);</span>

<span class="fc bfc" id="L198" title="All 2 branches covered.">            if (regionVolume &gt; criticalVolume) {</span>
<span class="fc" id="L199">                int target = (int) (nucleusCondFraction * criticalVolume);</span>

<span class="fc" id="L201">                Potts potts = ((PottsSimulation) sim).getPotts();</span>
<span class="fc" id="L202">                PottsLocations location = (PottsLocations) cell.getLocation();</span>
<span class="fc" id="L203">                location.distribute(Region.NUCLEUS, target, random);</span>
<span class="fc" id="L204">                location.update(cell.getID(), potts.ids, potts.regions);</span>

<span class="fc" id="L206">                cell.setTargets(</span>
                        Region.DEFAULT,
<span class="fc" id="L208">                        cell.getVolume(Region.DEFAULT),</span>
<span class="fc" id="L209">                        cell.getSurface(Region.DEFAULT));</span>
<span class="fc" id="L210">                cell.setTargets(</span>
                        Region.NUCLEUS,
<span class="fc" id="L212">                        cell.getVolume(Region.NUCLEUS),</span>
<span class="fc" id="L213">                        cell.getSurface(Region.NUCLEUS));</span>
            }
        }

        // Check for phase transition.
<span class="fc" id="L218">        Poisson poisson = poissonFactory.createPoisson(rateM, random);</span>
<span class="fc" id="L219">        currentSteps += poisson.nextInt();</span>
<span class="fc bfc" id="L220" title="All 2 branches covered.">        if (currentSteps &gt;= stepsM) {</span>
<span class="fc" id="L221">            addCell(random, sim);</span>
<span class="fc" id="L222">            setPhase(Phase.PROLIFERATIVE_G1);</span>
        }
<span class="fc" id="L224">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.5.201910111838</span></div></body></html>