<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>Box.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">arcade</a> &gt; <a href="index.source.html" class="el_package">arcade.core.util</a> &gt; <span class="el_source">Box.java</span></div><h1>Box.java</h1><pre class="source lang-java linenums">package arcade.core.util;

import java.util.ArrayList;
import java.util.HashSet;

/**
 * Container that maps a key to a tag category and a series of attributes.
 *
 * &lt;p&gt;{@code Box} objects use two {@link arcade.core.util.MiniBox} objects to map between key, tags,
 * and attributes. Rather than nesting the key to attribute to values, the class automatically joins
 * key and attribute into a new key.
 */
public class Box {
    /** Separator character for keys. */
    public static final String KEY_SEPARATOR = &quot;~&quot;;

    /** List of keys. */
    final ArrayList&lt;String&gt; keys;

    /** Map of id to tag. */
    final MiniBox idToTag;

    /** Map of id to value. */
    final MiniBox idToVal;

    /** Creates a {@code Box} object. */
<span class="fc" id="L27">    public Box() {</span>
<span class="fc" id="L28">        keys = new ArrayList&lt;&gt;();</span>
<span class="fc" id="L29">        idToTag = new MiniBox();</span>
<span class="fc" id="L30">        idToVal = new MiniBox();</span>
<span class="fc" id="L31">    }</span>

    /**
     * Checks if the given key exists.
     *
     * @param id the key
     * @return {@code true} if the key exists, {@code false} otherwise
     */
    public boolean contains(String id) {
<span class="fc" id="L40">        return keys.contains(id);</span>
    }

    /**
     * Gets list of keys in the box.
     *
     * @return the list of keys
     */
    public ArrayList&lt;String&gt; getKeys() {
<span class="fc" id="L49">        return keys;</span>
    }

    /**
     * Gets the value for the given key.
     *
     * @param key the key
     * @return the entry
     */
    public String getValue(String key) {
<span class="fc" id="L59">        return idToVal.get(key);</span>
    }

    /**
     * Gets the tag for a given key.
     *
     * @param key the key
     * @return the tag
     */
    public String getTag(String key) {
<span class="fc" id="L69">        return idToTag.get(key);</span>
    }

    /**
     * Adds tag category for a given id.
     *
     * &lt;p&gt;Automatically updates the list of keys.
     *
     * @param id the id
     * @param tag the tag
     */
    public void addTag(String id, String tag) {
<span class="fc bfc" id="L81" title="All 2 branches covered.">        if (!keys.contains(id)) {</span>
<span class="fc" id="L82">            keys.add(id);</span>
        }
<span class="fc" id="L84">        idToTag.put(id, tag);</span>
<span class="fc" id="L85">    }</span>

    /**
     * Adds an attribute for the given id.
     *
     * @param id the id
     * @param att the attribute name
     * @param val the attribute value
     */
    public void addAtt(String id, String att, String val) {
<span class="fc bfc" id="L95" title="All 2 branches covered.">        if (!keys.contains(id)) {</span>
<span class="fc" id="L96">            keys.add(id);</span>
        }
<span class="fc" id="L98">        idToVal.put(id + KEY_SEPARATOR + att, val);</span>
<span class="fc" id="L99">    }</span>

    /**
     * Adds a value for a given id.
     *
     * @param id the id
     * @param val the value
     */
    public void add(String id, String val) {
<span class="fc" id="L108">        String key = id.split(KEY_SEPARATOR)[0];</span>
<span class="fc bfc" id="L109" title="All 2 branches covered.">        if (!keys.contains(key)) {</span>
<span class="fc" id="L110">            keys.add(key);</span>
        }
<span class="fc" id="L112">        idToVal.put(id, val);</span>
<span class="fc" id="L113">    }</span>

    /**
     * Gets a mapping from attribute name to value for a given id.
     *
     * @param id the id
     * @return a map of attribute names to values
     */
    public MiniBox getAttValForId(String id) {
<span class="fc" id="L122">        MiniBox result = new MiniBox();</span>
<span class="fc bfc" id="L123" title="All 2 branches covered.">        for (String key : idToVal.getKeys()) {</span>
<span class="fc" id="L124">            String[] split = key.split(KEY_SEPARATOR);</span>
<span class="fc bfc" id="L125" title="All 2 branches covered.">            if (split[0].equals(id)) {</span>
<span class="fc" id="L126">                result.put(split[1], idToVal.get(key));</span>
            }
<span class="fc" id="L128">        }</span>
<span class="fc" id="L129">        return result;</span>
    }

    /**
     * Gets a mapping from id to value for untagged entries.
     *
     * @return a map of id to value
     */
    public MiniBox getIdVal() {
<span class="fc" id="L138">        MiniBox result = new MiniBox();</span>
<span class="fc bfc" id="L139" title="All 2 branches covered.">        for (String key : idToVal.getKeys()) {</span>
<span class="fc" id="L140">            String[] split = key.split(KEY_SEPARATOR);</span>
<span class="fc bfc" id="L141" title="All 2 branches covered.">            if (split.length == 1) {</span>
<span class="fc" id="L142">                result.put(key, idToVal.get(key));</span>
            }
<span class="fc" id="L144">        }</span>
<span class="fc" id="L145">        return result;</span>
    }

    /**
     * Gets a mapping from id to value of &quot;value&quot; attribute for a given tag.
     *
     * @param tag the tag
     * @return the map of id to value
     */
    public MiniBox getIdValForTag(String tag) {
<span class="fc" id="L155">        return getIdValForTagAtt(tag, &quot;value&quot;);</span>
    }

    /**
     * Gets a mapping from id to selected attribute value for a given tag.
     *
     * @param tag the tag
     * @param att the attribute name
     * @return a map of id to selected attribute value
     */
    public MiniBox getIdValForTagAtt(String tag, String att) {
<span class="fc" id="L166">        MiniBox result = new MiniBox();</span>
<span class="fc bfc" id="L167" title="All 2 branches covered.">        for (String key : idToVal.getKeys()) {</span>
<span class="fc" id="L168">            String[] split = key.split(KEY_SEPARATOR);</span>
<span class="fc bfc" id="L169" title="All 4 branches covered.">            if (split[1].equals(att) &amp;&amp; idToTag.get(split[0]).equals(tag)) {</span>
<span class="fc" id="L170">                result.put(split[0], idToVal.get(key));</span>
            }
<span class="fc" id="L172">        }</span>
<span class="fc" id="L173">        return result;</span>
    }

    /**
     * Filters box for entries matching the given tag.
     *
     * @param tag the tag
     * @return a list of unique entries
     */
    public HashSet&lt;String&gt; filterTags(String tag) {
<span class="fc" id="L183">        HashSet&lt;String&gt; result = new HashSet&lt;&gt;();</span>

<span class="fc bfc" id="L185" title="All 2 branches covered.">        for (String key : idToTag.getKeys()) {</span>
<span class="fc bfc" id="L186" title="All 2 branches covered.">            if (idToTag.get(key).equals(tag)) {</span>
<span class="fc" id="L187">                result.add(key);</span>
            }
<span class="fc" id="L189">        }</span>

<span class="fc" id="L191">        return result;</span>
    }

    /**
     * Filters box by entries matching the given tag.
     *
     * @param tag the tag
     * @return a box containing filtered entries
     */
    public Box filterBoxByTag(String tag) {
<span class="fc" id="L201">        Box result = new Box();</span>

        // Check each key to see if tag matches given tag.
<span class="fc bfc" id="L204" title="All 2 branches covered.">        for (String key : idToVal.getKeys()) {</span>
<span class="fc" id="L205">            String[] split = key.split(KEY_SEPARATOR);</span>
<span class="fc" id="L206">            String id = split[0];</span>
<span class="fc bfc" id="L207" title="All 4 branches covered.">            if (idToTag.contains(id) &amp;&amp; idToTag.get(id).equals(tag)) {</span>
<span class="fc" id="L208">                result.addTag(id, tag);</span>
<span class="fc" id="L209">                result.add(key, idToVal.get(key));</span>
            }
<span class="fc" id="L211">        }</span>

<span class="fc" id="L213">        return result;</span>
    }

    /**
     * Filters box by entries matching the given attribute.
     *
     * @param att the attribute
     * @return a box containing filtered entries
     */
    public Box filterBoxByAtt(String att) {
<span class="fc" id="L223">        Box result = new Box();</span>
<span class="fc" id="L224">        ArrayList&lt;String&gt; ids = new ArrayList&lt;&gt;();</span>

        // Get list of ids matching given attribute value.
<span class="fc bfc" id="L227" title="All 2 branches covered.">        for (String key : keys) {</span>
<span class="fc bfc" id="L228" title="All 2 branches covered.">            if (idToVal.contains(key + KEY_SEPARATOR + att)) {</span>
<span class="fc" id="L229">                ids.add(key);</span>
            }
<span class="fc" id="L231">        }</span>

        // Add all entries for the key to the new box.
<span class="fc bfc" id="L234" title="All 2 branches covered.">        for (String key : idToVal.getKeys()) {</span>
<span class="fc" id="L235">            String[] split = key.split(KEY_SEPARATOR);</span>
<span class="fc" id="L236">            String id = split[0];</span>
<span class="fc bfc" id="L237" title="All 2 branches covered.">            if (ids.contains(split[0])) {</span>
<span class="fc" id="L238">                result.addTag(id, idToTag.get(id));</span>
<span class="fc" id="L239">                result.add(key, idToVal.get(key));</span>
            }
<span class="fc" id="L241">        }</span>

<span class="fc" id="L243">        return result;</span>
    }

    /**
     * Compares two {@code Box} instances.
     *
     * @param box the {@code Box} to compare to
     * @return {@code true} if entries match, {@code false} otherwise
     */
    public boolean compare(Box box) {
<span class="fc bfc" id="L253" title="All 4 branches covered.">        return idToTag.compare(box.idToTag) &amp;&amp; idToVal.compare(box.idToVal);</span>
    }

    /**
     * Formats the {@code Box} as a string.
     *
     * @return the string
     */
    public String toString() {
<span class="fc" id="L262">        String format = &quot;\t[%s] %s\n&quot;;</span>
<span class="fc" id="L263">        StringBuilder s = new StringBuilder();</span>
<span class="fc" id="L264">        s.append(getIdVal().toString());</span>
<span class="fc bfc" id="L265" title="All 2 branches covered.">        for (String id : idToTag.getKeys()) {</span>
<span class="fc" id="L266">            s.append(String.format(format, idToTag.get(id), id));</span>
<span class="fc" id="L267">            s.append(getAttValForId(id).toString());</span>
<span class="fc" id="L268">        }</span>
<span class="fc" id="L269">        return s.toString();</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.5.201910111838</span></div></body></html>