<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>PatchProcessMetabolism.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">arcade</a> &gt; <a href="index.source.html" class="el_package">arcade.patch.agent.process</a> &gt; <span class="el_source">PatchProcessMetabolism.java</span></div><h1>PatchProcessMetabolism.java</h1><pre class="source lang-java linenums">package arcade.patch.agent.process;

import java.util.List;
import sim.util.Bag;
import ec.util.MersenneTwisterFast;
import arcade.core.sim.Simulation;
import arcade.core.util.MiniBox;
import arcade.patch.agent.cell.PatchCell;
import arcade.patch.env.grid.PatchGrid;
import static arcade.patch.util.PatchEnums.State;

/**
 * Implementation of {@link Process} for cell metabolism.
 *
 * &lt;p&gt;The {@code PatchProcessMetabolism} process:
 *
 * &lt;ul&gt;
 *   &lt;li&gt;gets available glucose and oxygen from the environment
 *   &lt;li&gt;calculates energy consumption (ATP) given cell size and state
 *   &lt;li&gt;steps the metabolism process (implemented with different complexities) to determine changes
 *       to energy and volume
 *   &lt;li&gt;updates glucose and oxygen environment with consumption
 * &lt;/ul&gt;
 *
 * &lt;p&gt;All metabolism complexities use both the glycolysis and oxidative phosphorylation pathways to
 * generate energy. Several stoichiometric ratios for glucose, oxygen, and pyruvate in glycolysis
 * and oxidative phosphorylation are provided. Glucose and oxygen are numbered constants, codes may
 * be added for additional molecules.
 */
public abstract class PatchProcessMetabolism extends PatchProcess {
    /** ID for glucose. */
    static final int GLUCOSE = 0;

    /** ID for oxygen. */
    static final int OXYGEN = 1;

    /** Energy from glycolysis [mol ATP/mol glucose]. */
    static final int ENERGY_FROM_GLYC = 2;

    /** Energy from oxidative phosphorylation [mol ATP/mol pyruvate]. */
    static final int ENERGY_FROM_OXPHOS = 15;

    /** Stoichiometric ratio for oxygen:pyruvate [mol oxygen/mol pyruvate]. */
    static final int OXY_PER_PYRU = 3;

    /** Stoichiometric ratio for pyruvate:glucose [mol pyruvate/mol glucose]. */
    static final int PYRU_PER_GLUC = 2;

    /** Basal energy requirement [fmol ATP/um&lt;sup&gt;3&lt;/sup&gt; cell/min]. */
    private final double basalEnergy;

    /** Additional energy required for proliferation [fmol ATP/um&lt;sup&gt;3&lt;/sup&gt; cell/min]. */
    private final double proliferationEnergy;

    /** Additional energy required for migration [fmol ATP/um&lt;sup&gt;3&lt;/sup&gt; cell/min]. */
    private final double migrationEnergy;

    /** Oxygen solubility in tissue [fmol O2/um&lt;sup&gt;3&lt;/sup&gt;/mmHg]. */
    private final double oxygenSolubilityTissue;

    /** Cell density [ng/um&lt;sup&gt;3&lt;/sup&gt;]. */
    final double cellDensity;

    /** Ratio of glucose to biomass [fmol glucose/ng biomass]. */
    final double ratioGlucoseBiomass;

    /** List of internal names. */
    List&lt;String&gt; names;

    /** List of internal amounts [fmol]. */
    double[] intAmts;

    /** List of external amounts [fmol]. */
    final double[] extAmts;

    /** List of uptake amounts [fmol]. */
    final double[] upAmts;

    /** Volume fraction. */
    protected double f;

    /** Cell energy [ATP]. */
    double energy;

    /** Volume of cell [um&lt;sup&gt;3&lt;/sup&gt;]. */
    double volume;

    /** Dry mass of cell [ng]. */
    double mass;

    /** Critical cell mass. */
    final double critMass;

    /** Energy consumed. */
    double energyCons;

    /** Energy required. */
    double energyReq;

    /** {@code true} if cell is in proliferative state, {@code false} otherwise. */
    protected boolean isProliferative;

    /** {@code true} if cell is in migratory state, {@code false} otherwise. */
    protected boolean isMigratory;

    /**
     * Creates a metabolism {@link PatchProcess} for the given cell.
     *
     * &lt;p&gt;Process parameters are specific for the cell population. Loaded parameters include:
     *
     * &lt;ul&gt;
     *   &lt;li&gt;{@code BASAL_ENERGY} = basal energy requirement
     *   &lt;li&gt;{@code PROLIFERATION_ENERGY} = additional energy required for proliferation
     *   &lt;li&gt;{@code MIGRATION_ENERGY} = additional energy required for migration
     *   &lt;li&gt;{@code CELL_DENSITY} = cell density
     *   &lt;li&gt;{@code RATIO_GLUCOSE_BIOMASS} = ratio of glucose to biomass
     *   &lt;li&gt;{@code OXYGEN_SOLUBILITY_TISSUE} = oxygen solubility in tissue
     * &lt;/ul&gt;
     *
     * &lt;p&gt;The process starts with energy at zero and assumes a constant ratio between mass and
     * volume (through density).
     *
     * @param cell the {@link PatchCell} the process is associated with
     */
    PatchProcessMetabolism(PatchCell cell) {
<span class="fc" id="L126">        super(cell);</span>

        // Set parameters.
<span class="fc" id="L129">        MiniBox parameters = cell.getParameters();</span>
<span class="fc" id="L130">        basalEnergy = parameters.getDouble(&quot;metabolism/BASAL_ENERGY&quot;);</span>
<span class="fc" id="L131">        proliferationEnergy = parameters.getDouble(&quot;metabolism/PROLIFERATION_ENERGY&quot;);</span>
<span class="fc" id="L132">        migrationEnergy = parameters.getDouble(&quot;metabolism/MIGRATION_ENERGY&quot;);</span>
<span class="fc" id="L133">        cellDensity = parameters.getDouble(&quot;metabolism/CELL_DENSITY&quot;);</span>
<span class="fc" id="L134">        ratioGlucoseBiomass = parameters.getDouble(&quot;metabolism/RATIO_GLUCOSE_BIOMASS&quot;);</span>
<span class="fc" id="L135">        oxygenSolubilityTissue = parameters.getDouble(&quot;metabolism/OXYGEN_SOLUBILITY_TISSUE&quot;);</span>

        // Initialize process.
<span class="fc" id="L138">        volume = cell.getVolume();</span>
<span class="fc" id="L139">        energy = 0;</span>
<span class="fc" id="L140">        mass = cell.getVolume() * cellDensity;</span>
<span class="fc" id="L141">        critMass = cell.getCriticalVolume() * cellDensity;</span>

        // Initialize external and uptake concentration arrays;
<span class="fc" id="L144">        extAmts = new double[2];</span>
<span class="fc" id="L145">        upAmts = new double[2];</span>
<span class="fc" id="L146">    }</span>

    /**
     * Steps the metabolism process.
     *
     * @param random the random number generator
     * @param sim the simulation instance
     */
    abstract void stepProcess(MersenneTwisterFast random, Simulation sim);

    /**
     * Gets the external amounts of glucose and oxygen in fmol.
     *
     * @param sim the simulation instance
     */
    private void updateExternal(Simulation sim) {
<span class="nc" id="L162">        extAmts[GLUCOSE] =</span>
<span class="nc" id="L163">                sim.getLattice(&quot;GLUCOSE&quot;).getAverageValue(location) * location.getVolume();</span>
<span class="nc" id="L164">        extAmts[OXYGEN] =</span>
<span class="nc" id="L165">                sim.getLattice(&quot;OXYGEN&quot;).getAverageValue(location)</span>
<span class="nc" id="L166">                        * location.getVolume()</span>
                        * oxygenSolubilityTissue;
<span class="nc" id="L168">    }</span>

    @Override
    public void step(MersenneTwisterFast random, Simulation sim) {
        // Calculate fraction of volume occupied by cell.
<span class="nc" id="L173">        Bag bag = ((PatchGrid) sim.getGrid()).getObjectsAtLocation(location);</span>
<span class="nc" id="L174">        double totalVolume = PatchCell.calculateTotalVolume(bag);</span>
<span class="nc" id="L175">        f = volume / totalVolume;</span>

<span class="nc" id="L177">        updateExternal(sim);</span>

        // Check cell state.
<span class="nc bnc" id="L180" title="All 2 branches missed.">        isProliferative = cell.getState() == State.PROLIFERATIVE;</span>
<span class="nc bnc" id="L181" title="All 2 branches missed.">        isMigratory = cell.getState() == State.MIGRATORY;</span>

        // Calculate energy consumption.
<span class="nc" id="L184">        energyCons =</span>
                volume
                        * (basalEnergy
<span class="nc bnc" id="L187" title="All 2 branches missed.">                                + (isProliferative ? proliferationEnergy : 0)</span>
<span class="nc bnc" id="L188" title="All 2 branches missed.">                                + (isMigratory ? migrationEnergy : 0));</span>
<span class="nc" id="L189">        energyReq = energyCons - energy;</span>

        // Modify energy and volume.
<span class="nc" id="L192">        stepProcess(random, sim);</span>

        // Update environment.
<span class="nc" id="L195">        sim.getLattice(&quot;GLUCOSE&quot;).updateValue(location, 1.0 - upAmts[GLUCOSE] / extAmts[GLUCOSE]);</span>
<span class="nc" id="L196">        sim.getLattice(&quot;OXYGEN&quot;).updateValue(location, 1.0 - upAmts[OXYGEN] / extAmts[OXYGEN]);</span>

        // Update cell agent.
<span class="nc" id="L199">        cell.setVolume(volume);</span>
<span class="nc" id="L200">        cell.setEnergy(energy);</span>
<span class="nc" id="L201">    }</span>

    /**
     * Creates a {@code PatchProcessMetabolism} for given version.
     *
     * @param cell the {@link PatchCell} the process is associated with
     * @param version the process version
     * @return the process instance
     */
    public static PatchProcess make(PatchCell cell, String version) {
<span class="pc bpc" id="L211" title="4 of 5 branches missed.">        switch (version.toUpperCase()) {</span>
            case &quot;RANDOM&quot;:
<span class="nc" id="L213">                return new PatchProcessMetabolismRandom(cell);</span>
            case &quot;SIMPLE&quot;:
<span class="nc" id="L215">                return new PatchProcessMetabolismSimple(cell);</span>
            case &quot;MEDIUM&quot;:
<span class="fc" id="L217">                return new PatchProcessMetabolismMedium(cell);</span>
            case &quot;COMPLEX&quot;:
<span class="nc" id="L219">                return new PatchProcessMetabolismComplex(cell);</span>
            default:
<span class="nc" id="L221">                return null;</span>
        }
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.5.201910111838</span></div></body></html>