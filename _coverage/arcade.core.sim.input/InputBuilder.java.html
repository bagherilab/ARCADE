<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>InputBuilder.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">arcade</a> &gt; <a href="index.source.html" class="el_package">arcade.core.sim.input</a> &gt; <span class="el_source">InputBuilder.java</span></div><h1>InputBuilder.java</h1><pre class="source lang-java linenums">package arcade.core.sim.input;

import java.io.IOException;
import java.util.ArrayList;
import java.util.HashMap;
import java.util.logging.Logger;
import javax.xml.parsers.SAXParser;
import javax.xml.parsers.SAXParserFactory;
import org.xml.sax.Attributes;
import org.xml.sax.ContentHandler;
import org.xml.sax.Locator;
import org.xml.sax.SAXException;
import org.xml.sax.XMLReader;
import arcade.core.sim.Series;
import arcade.core.util.Box;
import arcade.core.util.MiniBox;

/**
 * Custom builder for simulation setup XMLs.
 * &lt;p&gt;
 * The class checks for specific tags, which determine where the parsed data is
 * placed for further processing by the {@link arcade.core.sim.Series} class.
 * Once the end tag for a given {@code &lt;series&gt;} is reached, a new
 * {@link arcade.core.sim.Series} object is instantiated. All content in the
 * setup XML is stored as attribute-value pairs; there is no content between
 * tags (the {@code characters} method is not used).
 * &lt;p&gt;
 * General structure of the XML file (attributes not listed):
 * &lt;pre&gt;
 *     &amp;#60;set&amp;#62;
 *         &amp;#60;series&amp;#62;
 *             &amp;#60;simulation /&amp;#62;
 *             &amp;#60;agents /&amp;#62;
 *             &amp;#60;environment /&amp;#62;
 *         &amp;#60;/series&amp;#62;
 *         ...
 *     &amp;#60;/set&amp;#62;
 * &lt;/pre&gt;
 */

public abstract class InputBuilder implements ContentHandler {
    /** Logger for {@code InputBuilder}. */
<span class="fc" id="L43">    protected static final Logger LOGGER = Logger.getLogger(InputBuilder.class.getName());</span>
    
    /** XML reader. */
    XMLReader xmlReader;
    
    /** List holding {@link arcade.core.sim.Series} instances. */
    public ArrayList&lt;Series&gt; series;
    
    /** Tracker for document location. */
    Locator locator;
    
    /** Document identifier. */
    String document;
    
    /** Map of setup dictionaries. */
    public HashMap&lt;String, MiniBox&gt; setupDicts;
    
    /** Map of setup lists of dictionaries. */
    public HashMap&lt;String, ArrayList&lt;Box&gt;&gt; setupLists;
    
    /** Simulation output file path. */
    public String path;
    
    /** Container for default parameter values. */
    public Box parameters;
    
    /** {@code true} if run with visualization, {@code false} otherwise. */
    public boolean isVis;
    
    /**
     * Creates a {@code Handler} using {@code SAXParserFactory}.
     */
<span class="fc" id="L75">    public InputBuilder() {</span>
        try {
<span class="fc" id="L77">            SAXParserFactory spf = SAXParserFactory.newInstance();</span>
<span class="fc" id="L78">            SAXParser saxParser = spf.newSAXParser();</span>
<span class="fc" id="L79">            xmlReader = saxParser.getXMLReader();</span>
<span class="fc" id="L80">            xmlReader.setContentHandler(this);</span>
<span class="nc" id="L81">        } catch (Exception e) {</span>
<span class="nc" id="L82">            e.printStackTrace();</span>
<span class="fc" id="L83">        }</span>
<span class="fc" id="L84">    }</span>
    
    /**
     * Builds {@link arcade.core.sim.Series} from the given XML file.
     * &lt;p&gt;
     * Reads through the setup XML file using an SAX parser with custom defined
     * content handler, which creates the {@link arcade.core.sim.Series} objects
     * as they are parsed. SAX parses XML files using event handlers and so does
     * not load the entire XML file into memory (in contrast to DOM).
     *
     * @param xml  the XML file
     * @return  a list of {@link arcade.core.sim.Series} instances
     */
    public ArrayList&lt;Series&gt; build(String xml)
            throws IOException, SAXException {
<span class="fc" id="L99">        series = new ArrayList&lt;&gt;();</span>
        
<span class="fc" id="L101">        LOGGER.config(&quot;building series from XML file [ &quot; + xml + &quot; ]&quot;);</span>
<span class="fc" id="L102">        xmlReader.parse(xml);</span>
<span class="fc" id="L103">        LOGGER.config(&quot;successfully built series from XML file [ &quot; + xml + &quot; ]&quot;);</span>
        
<span class="fc" id="L105">        return series;</span>
    }
    
    /**
     * Creates a {@link arcade.core.util.MiniBox} dictionary from attributes.
     *
     * @param atts  the attributes
     * @return  a dictionary
     */
    protected MiniBox makeMiniBox(Attributes atts) {
<span class="fc" id="L115">        MiniBox box = new MiniBox();</span>
<span class="fc bfc" id="L116" title="All 2 branches covered.">        for (int i = 0; i &lt; atts.getLength(); i++) {</span>
<span class="fc" id="L117">            box.put(atts.getQName(i), atts.getValue(i));</span>
        }
<span class="fc" id="L119">        return box;</span>
    }
    
    /**
     * Creates a {@link arcade.core.util.Box} dictionary from given attributes.
     *
     * @param atts  the attributes
     * @return  a dictionary
     */
    protected Box makeBox(Attributes atts) {
<span class="fc" id="L129">        Box box = new Box();</span>
<span class="fc bfc" id="L130" title="All 2 branches covered.">        for (int i = 0; i &lt; atts.getLength(); i++) {</span>
<span class="fc" id="L131">            box.add(atts.getQName(i), atts.getValue(i));</span>
        }
<span class="fc" id="L133">        return box;</span>
    }
    
    @Override
<span class="fc" id="L137">    public void startPrefixMapping(String prefix, String uri) { }</span>
    
    @Override
<span class="fc" id="L140">    public void endPrefixMapping(String prefix) { }</span>
    
    @Override
<span class="fc" id="L143">    public void skippedEntity(String name) { }</span>
    
    @Override
<span class="fc" id="L146">    public void characters(char[] ch, int start, int length) { }</span>
    
    @Override
<span class="fc" id="L149">    public void ignorableWhitespace(char[] ch, int start, int length) { }</span>
    
    @Override
<span class="fc" id="L152">    public void processingInstruction(String target, String data) { }</span>
    
    @Override
    public void setDocumentLocator(Locator documentLocator) {
<span class="fc" id="L156">        this.locator = documentLocator;</span>
<span class="fc" id="L157">        this.document = locator.getSystemId();</span>
<span class="fc" id="L158">    }</span>
    
    @Override
    public void startDocument() {
<span class="fc" id="L162">        setupDicts = new HashMap&lt;&gt;();</span>
<span class="fc" id="L163">        setupLists = new HashMap&lt;&gt;();</span>
<span class="fc" id="L164">        LOGGER.fine(&quot;start document [ &quot; + document + &quot; ]&quot;);</span>
<span class="fc" id="L165">    }</span>
    
    @Override
    public void endDocument() {
<span class="fc" id="L169">        LOGGER.fine(&quot;end document [ &quot; + document + &quot; ]&quot;);</span>
<span class="fc" id="L170">    }</span>
    
    @Override
    public abstract void startElement(String uri, String local, String name, Attributes atts);
    
    @Override
    public abstract void endElement(String uri, String local, String name);
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.5.201910111838</span></div></body></html>