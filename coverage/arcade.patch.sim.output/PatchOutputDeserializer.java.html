<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>PatchOutputDeserializer.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">arcade</a> &gt; <a href="index.source.html" class="el_package">arcade.patch.sim.output</a> &gt; <span class="el_source">PatchOutputDeserializer.java</span></div><h1>PatchOutputDeserializer.java</h1><pre class="source lang-java linenums">package arcade.patch.sim.output;

import java.lang.reflect.Type;
import java.util.ArrayList;
import com.google.gson.Gson;
import com.google.gson.GsonBuilder;
import com.google.gson.JsonArray;
import com.google.gson.JsonDeserializationContext;
import com.google.gson.JsonDeserializer;
import com.google.gson.JsonElement;
import com.google.gson.JsonObject;
import com.google.gson.JsonParseException;
import arcade.core.agent.cell.CellContainer;
import arcade.core.env.location.LocationContainer;
import arcade.core.sim.output.OutputDeserializer;
import arcade.patch.agent.cell.PatchCellContainer;
import arcade.patch.env.location.Coordinate;
import arcade.patch.env.location.CoordinateUVWZ;
import arcade.patch.env.location.CoordinateXYZ;
import arcade.patch.env.location.PatchLocationContainer;
import static arcade.core.sim.Simulation.DEFAULT_LOCATION_TYPE;
import static arcade.patch.util.PatchEnums.State;

/**
 * Container class for patch-specific object deserializers.
 *
 * &lt;p&gt;Deserializers include:
 *
 * &lt;ul&gt;
 *   &lt;li&gt;{@link PatchCellDeserializer} for deserializing {@link PatchCellContainer}
 *   &lt;li&gt;{@link LocationListDeserializer} for deserializing {@link PatchLocationContainer} lists
 *   &lt;li&gt;{@link CoordinateDeserializer} for deserializing {@link Coordinate}
 * &lt;/ul&gt;
 */
public final class PatchOutputDeserializer {
    /** Hidden utility class constructor. */
<span class="nc" id="L37">    protected PatchOutputDeserializer() {</span>
<span class="nc" id="L38">        throw new UnsupportedOperationException();</span>
    }

    /**
     * Creates a {@code Gson} with generic and implementation-specific adaptors.
     *
     * @return a {@code Gson} instance
     */
    static Gson makeGSON() {
<span class="fc" id="L47">        GsonBuilder gsonBuilder = OutputDeserializer.makeGSONBuilder();</span>
<span class="fc" id="L48">        gsonBuilder.registerTypeAdapter(CellContainer.class, new PatchCellDeserializer());</span>
<span class="fc" id="L49">        gsonBuilder.registerTypeAdapter(PatchCellContainer.class, new PatchCellDeserializer());</span>
<span class="fc" id="L50">        gsonBuilder.registerTypeAdapter(DEFAULT_LOCATION_TYPE, new LocationListDeserializer());</span>
<span class="fc" id="L51">        gsonBuilder.registerTypeAdapter(Coordinate.class, new CoordinateDeserializer());</span>
<span class="fc" id="L52">        return gsonBuilder.create();</span>
    }

    /** Deserializer for {@link PatchCellContainer} objects. */
<span class="fc" id="L56">    static class PatchCellDeserializer implements JsonDeserializer&lt;PatchCellContainer&gt; {</span>
        @Override
        public PatchCellContainer deserialize(
                JsonElement json, Type typeOfT, JsonDeserializationContext context)
                throws JsonParseException {
<span class="nc" id="L61">            JsonObject jsonObject = json.getAsJsonObject();</span>

<span class="nc" id="L63">            int id = jsonObject.get(&quot;id&quot;).getAsInt();</span>
<span class="nc" id="L64">            int parent = jsonObject.get(&quot;parent&quot;).getAsInt();</span>
<span class="nc" id="L65">            int pop = jsonObject.get(&quot;pop&quot;).getAsInt();</span>
<span class="nc" id="L66">            int age = jsonObject.get(&quot;age&quot;).getAsInt();</span>
<span class="nc" id="L67">            int divisions = jsonObject.get(&quot;divisions&quot;).getAsInt();</span>
<span class="nc" id="L68">            double volume = jsonObject.get(&quot;volume&quot;).getAsDouble();</span>
<span class="nc" id="L69">            double height = jsonObject.get(&quot;height&quot;).getAsDouble();</span>

<span class="nc" id="L71">            State state = State.valueOf(jsonObject.get(&quot;state&quot;).getAsString());</span>

<span class="nc" id="L73">            JsonArray criticals = jsonObject.get(&quot;criticals&quot;).getAsJsonArray();</span>
<span class="nc" id="L74">            double criticalVolume = criticals.get(0).getAsDouble();</span>
<span class="nc" id="L75">            double criticalHeight = criticals.get(1).getAsDouble();</span>

<span class="nc" id="L77">            return new PatchCellContainer(</span>
                    id,
                    parent,
                    pop,
                    age,
                    divisions,
                    state,
                    volume,
                    height,
                    criticalVolume,
                    criticalHeight);
        }
    }

    /** Deserializer for list of {@link PatchLocationContainer} objects. */
<span class="fc" id="L92">    public static final class LocationListDeserializer</span>
            implements JsonDeserializer&lt;ArrayList&lt;LocationContainer&gt;&gt; {
        @Override
        public ArrayList&lt;LocationContainer&gt; deserialize(
                JsonElement json, Type typeOfT, JsonDeserializationContext context)
                throws JsonParseException {
<span class="nc" id="L98">            ArrayList&lt;LocationContainer&gt; locations = new ArrayList&lt;&gt;();</span>
<span class="nc" id="L99">            JsonArray jsonArray = json.getAsJsonArray();</span>

<span class="nc bnc" id="L101" title="All 2 branches missed.">            for (JsonElement element : jsonArray) {</span>
<span class="nc" id="L102">                JsonObject location = element.getAsJsonObject();</span>

<span class="nc" id="L104">                JsonElement coordinateElement = location.get(&quot;coordinate&quot;);</span>
<span class="nc" id="L105">                Coordinate coordinate = context.deserialize(coordinateElement, Coordinate.class);</span>

<span class="nc bnc" id="L107" title="All 2 branches missed.">                for (JsonElement idElement : location.getAsJsonArray(&quot;ids&quot;)) {</span>
<span class="nc" id="L108">                    int id = idElement.getAsInt();</span>
<span class="nc" id="L109">                    PatchLocationContainer container = new PatchLocationContainer(id, coordinate);</span>
<span class="nc" id="L110">                    locations.add(container);</span>
<span class="nc" id="L111">                }</span>
<span class="nc" id="L112">            }</span>

<span class="nc" id="L114">            return locations;</span>
        }
    }

    /** Deserializer for {@link Coordinate} objects. */
<span class="fc" id="L119">    static class CoordinateDeserializer implements JsonDeserializer&lt;Coordinate&gt; {</span>
        @Override
        public Coordinate deserialize(
                JsonElement json, Type typeOfT, JsonDeserializationContext context)
                throws JsonParseException {
<span class="nc" id="L124">            JsonArray jsonArray = json.getAsJsonArray();</span>

<span class="nc bnc" id="L126" title="All 2 branches missed.">            if (jsonArray.size() == 3) {</span>
<span class="nc" id="L127">                int x = jsonArray.get(0).getAsInt();</span>
<span class="nc" id="L128">                int y = jsonArray.get(1).getAsInt();</span>
<span class="nc" id="L129">                int z = jsonArray.get(2).getAsInt();</span>
<span class="nc" id="L130">                return new CoordinateXYZ(x, y, z);</span>
<span class="nc bnc" id="L131" title="All 2 branches missed.">            } else if (jsonArray.size() == 4) {</span>
<span class="nc" id="L132">                int u = jsonArray.get(0).getAsInt();</span>
<span class="nc" id="L133">                int v = jsonArray.get(1).getAsInt();</span>
<span class="nc" id="L134">                int w = jsonArray.get(2).getAsInt();</span>
<span class="nc" id="L135">                int z = jsonArray.get(3).getAsInt();</span>
<span class="nc" id="L136">                return new CoordinateUVWZ(u, v, w, z);</span>
            }

<span class="nc" id="L139">            return null;</span>
        }
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.5.201910111838</span></div></body></html>